---
title: 'E2126 case でローカル変数の初期化がとばされた'
date: '2013-12-07'
category: 'C++Builder'
---

以下のように、`switch` 文の `case` 内でローカル変数を宣言すると、

> E2126 case でローカル変数の初期化がとばされた

というエラーが発生します。

```cpp
switch (value) {
    case 0:
        int i = 10;    // エラー
        routine(i);
        break;

    case 1:
        break;

    default:
        break;
}
```

Embarcaderoのリファレンスには、このエラーについて以下のように書いてあります。

> C++では，ローカル変数の初期化を省略することは不正です。このエラーは，case ラベルにより，ローカル変数を素通りして制御が進む可能性があることを示します。
<cite>引用元: [E2126 case でローカル変数の初期化がとばされた (C++) - RAD Studio XE3](http://docwiki.embarcadero.com/RADStudio/XE3/ja/E2126_case_%E3%81%A7%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%8C%E3%81%A8%E3%81%B0%E3%81%95%E3%82%8C%E3%81%9F_(C%2B%2B))</cite>

ちょっと分かりにくいのですが、`case` 内でのローカル変数のスコープは、別の `case` 内にも及ぶので怒られるのではないかと勝手に理解しています。何故なら、C++ のローカル変数のスコープは、そのブロック内、つまり `{}` の中であるためです。上記の例で言えば、`switch` 文全体の `{}` になります。

解釈が合っているのかは分かりませんが、解決策としては、そのローカル変数のスコープを明確にしてやるということです。
```cpp
switch (value) {
    case 0:
        // 意図的にブロックを作る。
        {
            int i = 10;    // iのスコープはここから
            routine(i);
            break;
        }   // iのスコープはここまで

    case 1:
        break;

    default:
        break;
}
```

`if`, `for` 等の制御構文の始まり以外の場所でも、明示的なブロックを作る貴重な機会です。
